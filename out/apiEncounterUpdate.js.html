<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: apiEncounterUpdate.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: apiEncounterUpdate.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>// jshint esversion: 6
// jshint node: true
"use strict";


/**
* @desc task 9 (project), Geosoft 1, SoSe 2019;
* application to update the status of an encounter
*/


// import encounter models
const EncounterAnimal = require('../models/encounterAnimal');
const EncounterUser = require('../models/encounterUser');



/**
* @desc updates the status of real encounter for a specific encounter (the real encounter depends on the current user)
* @param {object} req request, containing information about the HTTP request
* @param {object} res response, to send back the desired HTTP response
*/
exports.postEncounterUpdate = (req, res) => {

  // query which database is queried
  if(req.body.encounterTyp === 'animal'){
    // the model of encounterAnimal pretends that an animal encounter has only one status property: "realEncounterCompared"
    EncounterAnimal.updateOne({_id: req.body.id}, {realEncounterCompared: req.body.real}).exec().then(resultAnimal => {
      res.json({real: req.body.real, encounterId: req.body.id, originalRoute: req.body.originalRoute});
    })
    .catch(err => {
      res.json(err);
    });
  }
  else {
    if(req.body.encounterTyp === 'me'){
      // if a user wants to change the status of the self-encounter, this must logically be changed for both properties
      EncounterUser.updateOne({_id: req.body.id}, {realEncounter: req.body.real, realEncounterCompared: req.body.real}).exec().then(resultMe => {
        res.json({real: req.body.real, encounterId: req.body.id, originalRoute: req.body.originalRoute, comparedRoute: req.body.comparedRoute});
      })
      .catch(err => {
        res.json(err);
      });
    }
    else {
      // if a user wants to change the status of the user-encounter, this may only happen with one property
      if(req.body.changedValue === 'compared'){
        // if the current user belongs to the 'compared'-property of the encounter, only 'realEncounterCompared' may be changed
        EncounterUser.updateOne({_id: req.body.id}, {realEncounterCompared: req.body.real}).exec().then(resultOthers => {
          res.json({real: req.body.real, encounterId: req.body.id, originalRoute: req.body.originalRoute});
        })
        .catch(err => {
          res.json(err);
        });
      }
      else {
        // if the current user belongs not to the 'compared'-property of the encounter, only 'realEncounter' may be changed
        EncounterUser.updateOne({_id: req.body.id}, {realEncounter: req.body.real}).exec().then(resultOthers => {
          res.json({real: req.body.real, encounterId: req.body.id, originalRoute: req.body.originalRoute});
        })
        .catch(err => {
          res.json(err);
        });
      }
    }
  }
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#asyncLoopAnimals">asyncLoopAnimals</a></li><li><a href="global.html#asyncLoopEncounter">asyncLoopEncounter</a></li><li><a href="global.html#asyncLoopHTTPGet">asyncLoopHTTPGet</a></li><li><a href="global.html#calculateEncounters">calculateEncounters</a></li><li><a href="global.html#calculateIntersect">calculateIntersect</a></li><li><a href="global.html#calculateMidCoordinate">calculateMidCoordinate</a></li><li><a href="global.html#calculateOverlap">calculateOverlap</a></li><li><a href="global.html#createFeatureCollection">createFeatureCollection</a></li><li><a href="global.html#createMessages">createMessages</a></li><li><a href="global.html#createPrettyLocationInfo">createPrettyLocationInfo</a></li><li><a href="global.html#deleteEncounter">deleteEncounter</a></li><li><a href="global.html#EncounterAnimal">EncounterAnimal</a></li><li><a href="global.html#EncounterUser">EncounterUser</a></li><li><a href="global.html#getAll">getAll</a></li><li><a href="global.html#getCreate">getCreate</a></li><li><a href="global.html#getDelete">getDelete</a></li><li><a href="global.html#getEncounter">getEncounter</a></li><li><a href="global.html#getImpressum">getImpressum</a></li><li><a href="global.html#getIndex">getIndex</a></li><li><a href="global.html#getLogin">getLogin</a></li><li><a href="global.html#getLogout">getLogout</a></li><li><a href="global.html#getOne">getOne</a></li><li><a href="global.html#getSignup">getSignup</a></li><li><a href="global.html#getUpdate">getUpdate</a></li><li><a href="global.html#here">here</a></li><li><a href="global.html#https">https</a></li><li><a href="global.html#mongoose">mongoose</a></li><li><a href="global.html#newEncounter">newEncounter</a></li><li><a href="global.html#postCreate">postCreate</a></li><li><a href="global.html#postEncounterFilter">postEncounterFilter</a></li><li><a href="global.html#postEncounterUpdate">postEncounterUpdate</a></li><li><a href="global.html#postLogin">postLogin</a></li><li><a href="global.html#postMovebank">postMovebank</a></li><li><a href="global.html#postMovebankUpdate">postMovebankUpdate</a></li><li><a href="global.html#postSignup">postSignup</a></li><li><a href="global.html#postUpdate">postUpdate</a></li><li><a href="global.html#saveEncounter">saveEncounter</a></li><li><a href="global.html#updateEncounter">updateEncounter</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Sun Sep 08 2019 23:45:28 GMT+0200 (GMT+02:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
